<<<<<<< HEAD
// @ts-check
=======
'use strict'

>>>>>>> parent of 82e7c980 (trying to back back before dimentios)
const req = require('./req.js')

/**
 * Plugin Loader
 *
 * @private
 * @method load
 *
 * @param  {String} plugin PostCSS Plugin Name
 * @param  {Object} options PostCSS Plugin Options
 *
<<<<<<< HEAD
 * @return {Promise<Function>} PostCSS Plugin
 */
async function load(plugin, options, file) {
=======
 * @return {Function} PostCSS Plugin
 */
const load = (plugin, options, file) => {
>>>>>>> parent of 82e7c980 (trying to back back before dimentios)
  try {
    if (
      options === null ||
      options === undefined ||
      Object.keys(options).length === 0
    ) {
<<<<<<< HEAD
      return await req(plugin, file)
    } else {
      return (await req(plugin, file))(options)
      /* c8 ignore next */
    }
  } catch (err) {
    throw new Error(
      `Loading PostCSS Plugin failed: ${err.message}\n\n(@${file})`
    )
=======
      return req(plugin, file)
    } else {
      return req(plugin, file)(options)
    }
  } catch (err) {
    throw new Error(`Loading PostCSS Plugin failed: ${err.message}\n\n(@${file})`)
>>>>>>> parent of 82e7c980 (trying to back back before dimentios)
  }
}

/**
 * Load Plugins
 *
 * @private
 * @method plugins
 *
 * @param {Object} config PostCSS Config Plugins
 *
<<<<<<< HEAD
 * @return {Promise<Array>} plugins PostCSS Plugins
 */
async function plugins(config, file) {
  let list = []

  if (Array.isArray(config.plugins)) {
    list = config.plugins.filter(Boolean)
  } else {
    list = Object.entries(config.plugins)
      .filter(([, options]) => {
        return options !== false
      })
      .map(([plugin, options]) => {
        return load(plugin, options, file)
      })
    list = await Promise.all(list)
  }

  if (list.length && list.length > 0) {
    list.forEach((plugin, i) => {
=======
 * @return {Array} plugins PostCSS Plugins
 */
const plugins = (config, file) => {
  let plugins = []

  if (Array.isArray(config.plugins)) {
    plugins = config.plugins.filter(Boolean)
  } else {
    plugins = Object.keys(config.plugins)
      .filter((plugin) => {
        return config.plugins[plugin] !== false ? plugin : ''
      })
      .map((plugin) => {
        return load(plugin, config.plugins[plugin], file)
      })
  }

  if (plugins.length && plugins.length > 0) {
    plugins.forEach((plugin, i) => {
>>>>>>> parent of 82e7c980 (trying to back back before dimentios)
      if (plugin.default) {
        plugin = plugin.default
      }

      if (plugin.postcss === true) {
        plugin = plugin()
      } else if (plugin.postcss) {
        plugin = plugin.postcss
      }

      if (
<<<<<<< HEAD
        !(
          (typeof plugin === 'object' && Array.isArray(plugin.plugins)) ||
          (typeof plugin === 'object' && plugin.postcssPlugin) ||
          typeof plugin === 'function'
        )
      ) {
        throw new TypeError(
          `Invalid PostCSS Plugin found at: plugins[${i}]\n\n(@${file})`
        )
=======
        // eslint-disable-next-line
        !(
          (typeof plugin === 'object' && Array.isArray(plugin.plugins)) ||
          (typeof plugin === 'object' && plugin.postcssPlugin) ||
          (typeof plugin === 'function')
        )
      ) {
        throw new TypeError(`Invalid PostCSS Plugin found at: plugins[${i}]\n\n(@${file})`)
>>>>>>> parent of 82e7c980 (trying to back back before dimentios)
      }
    })
  }

<<<<<<< HEAD
  return list
=======
  return plugins
>>>>>>> parent of 82e7c980 (trying to back back before dimentios)
}

module.exports = plugins
